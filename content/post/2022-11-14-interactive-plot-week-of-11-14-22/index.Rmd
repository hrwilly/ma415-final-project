---
title: Interactive Plot, Week of 11/14/22
author: Daniel Sussman
date: '2022-11-14'
slug: []
categories: []
tags: []
description: ~
toc: yes
authors: []
series: []
lastmod: '2022-11-14T09:43:26-05:00'
featuredVideo: ~
featuredImage: ~
---

For our interactive, we want to put the geographic location of all of the stadiums onto a map of the United States, colored by division. When your mouse hovers over a stadium, the name of the stadium will pop up. Clicking on a stadium will provide statistics for the home team.

The personalized aspect will be how the user has the ability to choose a stadium; they will be able to look at their home stadiums and/or favorite teams specifically.

DISCUSS: need big picture trends and zooming in -- ideas?
plots themselves also can't be static, use must provide input that changes what is displayed in plots themselves
interactions must be clear
maybe for highlighting interesting findings we can choose a few cool stats that will appear with the stadium name when you hover over it?
'Maybe use shiny to sort by years, and then in leaflet have a popup for winning percentage, and a scroll bar to select for certain winning percentages'

Our rough outline of our interactive is shown below. We still need to convert to Shiny.
```{r, interactive}
library(tidyverse)
library(rvest)
library(tibble)
library(readxl)
library(leaflet)
library(dplyr)
library(readr)
library(googlesheets4)



load(here::here("dataset", "baseball.RData"))



load(here::here("dataset", "baseball.RData"))
stadiums <- read_sheet("https://docs.google.com/spreadsheets/d/1p0R5qqR7XjoRG2mR5E1D_trlygHSqMOUdMgMpzq0gjU/htmlview")


AL_east <- c('BAL', 'BOS', 'NYA', 'TBA', 'TOR')
AL_central <- c('MIN', 'CLE', 'CHA', 'DET', 'KCN', 'KCR')
AL_west <- c('ANA', 'HOU', 'SEA', 'OAK', 'TEX' )
NL_east <- c('NYM', 'PHI', 'ATL', 'WAS', 'FLO' )
NL_central<- c('PTL','SLN',  'ATL', 'CHN', 'MIL', 'CIN')

mlbDivision <- function(x){
    
  if(x %in% AL_east){y <- 'AL East'} 
  else if(x %in% AL_central){y <- 'AL Central'} 
  else if(x %in% AL_west){y <- 'AL West'} 
  else if(x %in% NL_east){y <- 'NL East'} 
  else if(x %in% c(NL_central)){y <- 'NL Central'} 
  else { y <- 'NL West'}
  return(y)
}

icons <- makeAwesomeIcon(
    icon = 'circle',
    iconColor = 'black',
    library = 'glyphicon',
    markerColor = ifelse(stadiums$Abbreviation %in% AL_east, 'red',
                  ifelse(stadiums$`Team(s)` %in% AL_central,'blue',
                  ifelse(stadiums$`Team(s)` %in% AL_west, 'orange',
                  ifelse(stadiums$`Team(s)` %in% NL_east,'green',
                  ifelse(stadiums$`Team(s)` %in% NL_central,'darkpurple','black'))))))



mlbColor <- function(x){
    
  if(x == 'AL East'){y <- 'blue'}
  else if(x == 'AL Central'){y <- 'green'}
  else if(x == 'AL West'){y <- 'yellow'}
  else if(x == 'NL East'){y <- 'red'}
  else if(x == 'NL Central'){y <- 'purple'} 
  else {y <- 'black'}
  return(y)
  }


stadiums$Abbreviation[stadiums$Abbreviation == 'CHC'] <- 'CHN'
stadiums$Abbreviation[stadiums$Abbreviation == 'CHW'] <- 'CHA'
stadiums$Abbreviation[stadiums$Abbreviation == 'KCR'] <- 'KCN'
stadiums$Abbreviation[stadiums$Abbreviation == 'LAA'] <- 'ANA'
stadiums$Abbreviation[stadiums$Abbreviation == 'LAD'] <- 'LAN'
stadiums$Abbreviation[stadiums$Abbreviation == 'MIA'] <- 'FLO'
stadiums$Abbreviation[stadiums$Abbreviation == 'NYM'] <- 'NYN'
stadiums$Abbreviation[stadiums$Abbreviation == 'NYY'] <- 'NYA'
stadiums$Abbreviation[stadiums$Abbreviation == 'SDP'] <- 'SDN'
stadiums$Abbreviation[stadiums$Abbreviation == 'SFG'] <- 'SFN'
stadiums$Abbreviation[stadiums$Abbreviation == 'STL'] <- 'SLN'
stadiums$Abbreviation[stadiums$Abbreviation == 'TBR'] <- 'TBA'

MLBstadiums <- stadiums %>% filter(Sport == "MLB") %>% 
  mutate(Division = sapply(X = Abbreviation, FUN = mlbDivision),
           DivisionColor = sapply(X = Division, FUN = mlbColor),
           teamLabs = paste0('Team: ',Abbreviation,'\nField: ',Venue))



baseball_w_stadiums <- merge(baseball, stadiums, by.x=c("h_name"), 
                                                 by.y =("Abbreviation")) 


#leaflet(baseball_w_stadiums) %>% 
  #    setView(lng = -98.5795, lat = 39.8283, zoom = 5) %>% 
  #    addTiles() %>% 
  #    addAwesomeMarkers(~Longitude, ~Latitude, label = ~as.character(h_name)) #%>%
      #addLegend(position = 'bottomleft', opacity = 1,title = 'Divisions')


#save(MLBstadiums, file = "dataset/MLBstadiums.Rdata")


  
makeColorsandNames <- data.frame(divisions = c('AL East','AL Central','AL West','NL East','NL Central','NL West'), division.cent = c('#CC0000','#3399FF','#FFA500','#9ACD32','#483D8B','#000000'))
  
  
leaflet(MLBstadiums) %>% 
      setView(lng = -98.5795, lat = 39.8283, zoom = 5) %>% 
      addTiles() %>% 
      addAwesomeMarkers(~Longitude, ~Latitude, icon = icons, label = ~as.character(Venue), popup = ~as.character(Sport)) %>% 
      addLegend(position = 'bottomleft', colors = makeColorsandNames[,2],labels = makeColorsandNames[,1],opacity = 1,title = 'Divisions')

    
```

```{r, combining sets}
baseball_years_for_map <- baseball %>% group_by(year) %>% select(year, h_name, h_league)
baseball_years_for_map %>% pivot_wider(names_from = year, values_from = h_league)
```

```{r, shiny map}
library(shiny)

ui <- ui <- fluidPage(
  leafletOutput("mymap"),
  p()
)


server <- function(input,output, session){
  data <- reactive({
   x <- MLBstadiums
   
   #filteredData=subset(MLBstadiums, Year == input$yearselected)
   #return(filteredData)
 })  
  
  output$mymap <- renderLeaflet({
   #df <- data()
   
  m <- leaflet(MLBstadiums) %>% 
       setView(lng = -98.5795, lat = 39.8283, zoom = 5) %>% 
       addTiles() %>% 
       addAwesomeMarkers(~Longitude, ~Latitude, 
                        icon = icons, 
                        label = ~as.character(Venue), 
                        popup = ~as.character(Sport)) %>% 
      addLegend(position = 'bottomleft', 
                colors = makeColorsandNames[,2],
                labels = makeColorsandNames[,1],
                opacity = 1,title = 'Divisions')
   m
 }) 
}

shinyApp(ui, server, options = list(height = 550)) 
```

