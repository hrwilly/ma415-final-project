---
title: Data Loading and Cleaning, Week of 10/17/2022
author: Daniel Sussman
date: '2022-10-19'
slug: []
categories: []
tags: []
description: ~
toc: yes
authors: []
series: []
lastmod: '2022-10-19T09:38:50-04:00'
featuredVideo: ~
featuredImage: ~
---


<div id="TOC">

</div>

<p>Our data set of MLB game statistics is &gt;50mb and can be found in the <code>dataset-ignore</code> folder. After reading in the CSV file, we converted it into a tibble.</p>
<pre class="r"><code>suppressPackageStartupMessages(library(tidyverse))
suppressWarnings(data &lt;- read_csv(here::here(&quot;dataset-ignore&quot;, &quot;game_logs.csv&quot;), col_types = cols(forefeit = col_character(), completion = col_character())))
(baseball &lt;- as_tibble(data))</code></pre>
<pre><code>## # A tibble: 171,907 × 161
##       date numbe…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵ h_gam…⁶ v_score
##      &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt;
##  1  1.87e7       0 Thu     CL1    na            1 FW1    na            1       0
##  2  1.87e7       0 Fri     BS1    na            1 WS3    na            1      20
##  3  1.87e7       0 Sat     CL1    na            2 RC1    na            1      12
##  4  1.87e7       0 Mon     CL1    na            3 CH1    na            1      12
##  5  1.87e7       0 Tue     BS1    na            2 TRO    na            1       9
##  6  1.87e7       0 Thu     CH1    na            2 CL1    na            4      18
##  7  1.87e7       0 Sat     WS3    na            2 CL1    na            5      12
##  8  1.87e7       0 Sat     CH1    na            3 FW1    na            2      14
##  9  1.87e7       0 Mon     WS3    na            3 FW1    na            3       6
## 10  1.87e7       0 Tue     TRO    na            2 BS1    na            3      29
## # … with 171,897 more rows, 151 more variables: h_score &lt;dbl&gt;,
## #   length_outs &lt;dbl&gt;, day_night &lt;chr&gt;, completion &lt;chr&gt;, forefeit &lt;chr&gt;,
## #   protest &lt;chr&gt;, park_id &lt;chr&gt;, attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;,
## #   v_line_score &lt;chr&gt;, h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;,
## #   v_doubles &lt;dbl&gt;, v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;,
## #   v_sacrifice_hits &lt;dbl&gt;, v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;,
## #   v_walks &lt;dbl&gt;, `v_intentional walks` &lt;dbl&gt;, v_strikeouts &lt;dbl&gt;, …</code></pre>
<p>The date in the data is inserted as an integer, so using separate, we separated the date into three columns: <code>year</code>, <code>month</code>, and <code>day</code>. If we need to combine these, we can easily do so later on using lubridate.</p>
<pre class="r"><code>(baseball &lt;- baseball %&gt;% separate(date,into=c(&quot;year&quot;,&quot;month_day&quot;),sep=4) %&gt;% 
             separate(month_day,into=c(&quot;month&quot;,&quot;day&quot;),sep=2))</code></pre>
<pre><code>## # A tibble: 171,907 × 163
##    year  month day   number_of_g…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 1871  05    04                0 Thu     CL1    na            1 FW1    na     
##  2 1871  05    05                0 Fri     BS1    na            1 WS3    na     
##  3 1871  05    06                0 Sat     CL1    na            2 RC1    na     
##  4 1871  05    08                0 Mon     CL1    na            3 CH1    na     
##  5 1871  05    09                0 Tue     BS1    na            2 TRO    na     
##  6 1871  05    11                0 Thu     CH1    na            2 CL1    na     
##  7 1871  05    13                0 Sat     WS3    na            2 CL1    na     
##  8 1871  05    13                0 Sat     CH1    na            3 FW1    na     
##  9 1871  05    15                0 Mon     WS3    na            3 FW1    na     
## 10 1871  05    16                0 Tue     TRO    na            2 BS1    na     
## # … with 171,897 more rows, 153 more variables: h_game_number &lt;dbl&gt;,
## #   v_score &lt;dbl&gt;, h_score &lt;dbl&gt;, length_outs &lt;dbl&gt;, day_night &lt;chr&gt;,
## #   completion &lt;chr&gt;, forefeit &lt;chr&gt;, protest &lt;chr&gt;, park_id &lt;chr&gt;,
## #   attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;, v_line_score &lt;chr&gt;,
## #   h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;, v_doubles &lt;dbl&gt;,
## #   v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;, v_sacrifice_hits &lt;dbl&gt;,
## #   v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;, v_walks &lt;dbl&gt;, …</code></pre>
<p>Since this is a large dataset, we are considering working with those baseball games that took place between the years 2000 and 2016. Data on games from the 1970s and 1990s are missing so we chose to take a subset of more recent years of baseball. From the earliest years of the dataset, there are many variables with missing data as it might be too far in the past to recover such specific statistics of those games. Additionally, over the centuries of baseball, the rules of the game have changed so taking a subset of only the most recent years would help the data be more consistent.</p>
<pre class="r"><code>years&lt;-c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016)
(baseball &lt;- baseball%&gt;%filter(year %in% years))</code></pre>
<pre><code>## # A tibble: 41,298 × 163
##    year  month day   number_of_g…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 2000  03    29                0 Wed     CHN    NL            1 NYN    NL     
##  2 2000  03    30                0 Thu     NYN    NL            2 CHN    NL     
##  3 2000  04    03                0 Mon     COL    NL            1 ATL    NL     
##  4 2000  04    03                0 Mon     MIL    NL            1 CIN    NL     
##  5 2000  04    03                0 Mon     SFN    NL            1 FLO    NL     
##  6 2000  04    03                0 Mon     LAN    NL            1 MON    NL     
##  7 2000  04    03                0 Mon     SDN    NL            1 NYN    NL     
##  8 2000  04    03                0 Mon     CHN    NL            3 SLN    NL     
##  9 2000  04    03                0 Mon     NYA    AL            1 ANA    AL     
## 10 2000  04    03                0 Mon     CLE    AL            1 BAL    AL     
## # … with 41,288 more rows, 153 more variables: h_game_number &lt;dbl&gt;,
## #   v_score &lt;dbl&gt;, h_score &lt;dbl&gt;, length_outs &lt;dbl&gt;, day_night &lt;chr&gt;,
## #   completion &lt;chr&gt;, forefeit &lt;chr&gt;, protest &lt;chr&gt;, park_id &lt;chr&gt;,
## #   attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;, v_line_score &lt;chr&gt;,
## #   h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;, v_doubles &lt;dbl&gt;,
## #   v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;, v_sacrifice_hits &lt;dbl&gt;,
## #   v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;, v_walks &lt;dbl&gt;, …</code></pre>
<p>This data set does not specify whether the home team wins or loses, but it does contain information on the home team’s and the away team’s number of runs. Since we are interested in seeing if a team wins or loses, we created a column in the dataset called <code>score_diff</code>, which takes the number of the visiting team’s runs subtracted from the number of the one team’s runs. A positive value represents a win, a negative value represents a loss, and a zero is a tie. The higher absolute values represent a bigger win/loss.</p>
<pre class="r"><code>(baseball &lt;- baseball %&gt;% mutate(score_diff=h_score-v_score))</code></pre>
<pre><code>## # A tibble: 41,298 × 164
##    year  month day   number_of_g…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 2000  03    29                0 Wed     CHN    NL            1 NYN    NL     
##  2 2000  03    30                0 Thu     NYN    NL            2 CHN    NL     
##  3 2000  04    03                0 Mon     COL    NL            1 ATL    NL     
##  4 2000  04    03                0 Mon     MIL    NL            1 CIN    NL     
##  5 2000  04    03                0 Mon     SFN    NL            1 FLO    NL     
##  6 2000  04    03                0 Mon     LAN    NL            1 MON    NL     
##  7 2000  04    03                0 Mon     SDN    NL            1 NYN    NL     
##  8 2000  04    03                0 Mon     CHN    NL            3 SLN    NL     
##  9 2000  04    03                0 Mon     NYA    AL            1 ANA    AL     
## 10 2000  04    03                0 Mon     CLE    AL            1 BAL    AL     
## # … with 41,288 more rows, 154 more variables: h_game_number &lt;dbl&gt;,
## #   v_score &lt;dbl&gt;, h_score &lt;dbl&gt;, length_outs &lt;dbl&gt;, day_night &lt;chr&gt;,
## #   completion &lt;chr&gt;, forefeit &lt;chr&gt;, protest &lt;chr&gt;, park_id &lt;chr&gt;,
## #   attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;, v_line_score &lt;chr&gt;,
## #   h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;, v_doubles &lt;dbl&gt;,
## #   v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;, v_sacrifice_hits &lt;dbl&gt;,
## #   v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;, v_walks &lt;dbl&gt;, …</code></pre>
<p>Some filters we are considering are to filter by home team.</p>
<pre class="r"><code>baseball %&gt;% filter(h_name==&quot;BOS&quot;)</code></pre>
<pre><code>## # A tibble: 1,377 × 164
##    year  month day   number_of_g…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 2000  04    11                0 Tue     MIN    AL            9 BOS    AL     
##  2 2000  04    12                0 Wed     MIN    AL           10 BOS    AL     
##  3 2000  04    13                0 Thu     MIN    AL           11 BOS    AL     
##  4 2000  04    14                0 Fri     OAK    AL           10 BOS    AL     
##  5 2000  04    15                0 Sat     OAK    AL           11 BOS    AL     
##  6 2000  04    16                0 Sun     OAK    AL           12 BOS    AL     
##  7 2000  04    17                0 Mon     OAK    AL           13 BOS    AL     
##  8 2000  05    01                0 Mon     DET    AL           24 BOS    AL     
##  9 2000  05    02                0 Tue     DET    AL           25 BOS    AL     
## 10 2000  05    03                0 Wed     DET    AL           26 BOS    AL     
## # … with 1,367 more rows, 154 more variables: h_game_number &lt;dbl&gt;,
## #   v_score &lt;dbl&gt;, h_score &lt;dbl&gt;, length_outs &lt;dbl&gt;, day_night &lt;chr&gt;,
## #   completion &lt;chr&gt;, forefeit &lt;chr&gt;, protest &lt;chr&gt;, park_id &lt;chr&gt;,
## #   attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;, v_line_score &lt;chr&gt;,
## #   h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;, v_doubles &lt;dbl&gt;,
## #   v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;, v_sacrifice_hits &lt;dbl&gt;,
## #   v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;, v_walks &lt;dbl&gt;, …</code></pre>
<p>We filtered to select Boston Red Sox as the home team, since we have already found weather data for Boston and are considering taking this into account later on.</p>
<p>For our initial exploration of the data, we first looked at the average runs scored by each team at home as well as away arranged in descending order. Here, we can see which team scores the most runs on average. The Colorado Rockies score the most runs on average at home while the New York Yankees score the most runs on average away. Using our created variable <code>score_diff</code>, we can also observe which teams tend to lose or win more often.</p>
<pre class="r"><code>#Average runs scored by home teams
baseball %&gt;% group_by(h_name) %&gt;% summarize(average_score = mean(h_score)) %&gt;% arrange(desc(average_score))</code></pre>
<pre><code>## # A tibble: 32 × 2
##    h_name average_score
##    &lt;chr&gt;          &lt;dbl&gt;
##  1 COL             5.99
##  2 BOS             5.45
##  3 TEX             5.42
##  4 NYA             5.25
##  5 TOR             4.97
##  6 CHA             4.87
##  7 CLE             4.77
##  8 ARI             4.76
##  9 SLN             4.74
## 10 DET             4.70
## # … with 22 more rows</code></pre>
<pre class="r"><code>#Average runs scored by away/visiting teams
baseball %&gt;% group_by(v_name) %&gt;% summarize(average_score = mean(v_score)) %&gt;% arrange(desc(average_score))</code></pre>
<pre><code>## # A tibble: 32 × 2
##    v_name average_score
##    &lt;chr&gt;          &lt;dbl&gt;
##  1 NYA             5.00
##  2 BOS             4.86
##  3 ANA             4.84
##  4 SLN             4.80
##  5 CLE             4.72
##  6 OAK             4.67
##  7 SEA             4.63
##  8 TOR             4.62
##  9 TEX             4.60
## 10 DET             4.60
## # … with 22 more rows</code></pre>
<pre class="r"><code>#Proportion of games won by home team
baseball %&gt;% group_by(h_name) %&gt;% summarize(win_prop = mean(score_diff&gt;0)) %&gt;% arrange(desc(win_prop))</code></pre>
<pre><code>## # A tibble: 32 × 2
##    h_name win_prop
##    &lt;chr&gt;     &lt;dbl&gt;
##  1 NYA       0.619
##  2 SLN       0.607
##  3 BOS       0.581
##  4 LAN       0.574
##  5 ANA       0.573
##  6 ATL       0.573
##  7 OAK       0.572
##  8 SFN       0.571
##  9 TEX       0.555
## 10 CHA       0.548
## # … with 22 more rows</code></pre>
<pre class="r"><code>#Proportion of games won by away/visiting team
baseball %&gt;% group_by(v_name) %&gt;% summarize(win_prop = mean(score_diff&gt;0)) %&gt;% arrange(desc(win_prop))</code></pre>
<pre><code>## # A tibble: 32 × 2
##    v_name win_prop
##    &lt;chr&gt;     &lt;dbl&gt;
##  1 COL       0.617
##  2 MON       0.603
##  3 MIA       0.602
##  4 PIT       0.600
##  5 KCA       0.584
##  6 TBA       0.582
##  7 MIL       0.575
##  8 BAL       0.574
##  9 HOU       0.573
## 10 SDN       0.564
## # … with 22 more rows</code></pre>
<p>We can also look at <code>score_diff</code> for the Boston Red Sox on different days of the week. From the boxplot, it does not seem like the day of the week has an effect on whether the Red Sox win or lose.</p>
<pre class="r"><code>baseball %&gt;% filter(h_name == &quot;BOS&quot;) %&gt;% ggplot(aes(x = reorder(day_of_week, score_diff), y = score_diff)) + geom_boxplot()</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
