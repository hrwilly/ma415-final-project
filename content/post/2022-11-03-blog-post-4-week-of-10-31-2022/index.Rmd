---
title: Blog Post 4, Week of 10/31/2022
author: Daniel Sussman
date: '2022-11-03'
slug: []
categories: []
tags: []
description: ~
toc: yes
authors: []
series: []
lastmod: '2022-11-03T19:02:24-04:00'
featuredVideo: ~
featuredImage: ~
---

Two graphs EDA, one modeling graph

Graph #1 - Truly Exploratory Data: 
 
```{r graph1,echo=FALSE,fig.width=14,fig.length=25}
#Loading and cleaning the data
library(tidyverse)
data <- read_csv(here::here("dataset-ignore", "game_logs.csv"))
baseball <- as_tibble(data)
years<-c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016)
(baseball <- baseball %>% separate(date,into=c("year","month_day"),sep=4) %>% 
                          separate(month_day,into=c("month","day"),sep=2) %>% 
                          filter(year %in% years) %>% 
                          mutate(score_diff=h_score-v_score))

#Creating variables to compare a win to the starting pitcher, to see if having a certain pitcher matters towards a win
#This is focusing specifically on Boston Red Sox in their home stadium
(pitcher_win<-baseball %>% filter(h_name=="BOS",h_score>v_score) %>% 
                           group_by(h_starting_pitcher_name,year) %>% 
                           count(h_starting_pitcher_name) %>% 
                           rename(games_won=n))

(pitcher_played<-baseball %>% filter(h_name=="BOS") %>% 
                              group_by(h_starting_pitcher_name,year) %>% 
                              count(h_starting_pitcher_name) %>% 
                              rename(games_played=n))

(pitcher_prop<-full_join(pitcher_played,pitcher_win) %>% 
               mutate(prop=games_won/games_played) %>% 
               replace_na(list(games_won=0,prop=0,games_played=0)))

theme(axis.text.y=element_blank())+

#Graphing the proportion of games won to games played for each starting pitcher per season from 2000-2016.
pitcher_win %>% group_by(year) %>%
                ggplot(aes(h_starting_pitcher_name,games_won,fill=h_starting_pitcher_name))+
                geom_col()+coord_flip()+
                facet_wrap(vars(year),scales="free_y",ncol=3)+
                labs(title="Proportion of Games Won for each Starting Picture of the Boston Red Sox")+
                xlab("Proportion")+
                ylab("Pitcher")
```

Graph #2 - An experiment in the accuracy of the Pythagorean Winning Percentage (PWP)

$$Pythagroean\ Winning\ Percentage = runs\ scored\ ^{2} / (run\ scored\ ^{2} + runs\ allowed\  ^{2})$$
Compare the PWP to the actual winning percentage of the team. 
 - create winning percentage column: mutate(if(h_score>v_score) add column = win or TRUE )
      do a similar mutation for losses, and sum the wins divided by total 
 - Pythagorean column: baseball %>% mutate(pwp = h_score^2 / (h_score^2 + v_score^2))  
 - group by team and filter for only one team
 - plot one teams pwd vs year, and the actual winning percentage per year or season 

 missing a group my season or group  by year (however baseball works) in here somewhere 
 
```{r, graph2}
#win/loss column (1 = win, 0 = loss or tie)
h_win_loss <- function(h, v) {
  ifelse(h > v, 1, 0)
  
  # alternative to win loss function:
  # mutate(outcome = (ifelse(h_score>v_score, 1, 0))
}
(baseball <- baseball %>% mutate(h_win_loss = h_win_loss(h_score, v_score)))

#red sox games
bos <- baseball %>% filter(h_name == "BOS"|v_name == "BOS")

#for all teams
#total games won
home_wins <- baseball %>% group_by(h_name, year) %>% summarize(h_wins = sum(h_win_loss == 1))
away_wins <- baseball %>% group_by(v_name, year) %>% summarize(a_wins = sum(h_win_loss == 0))
team_year_wins <- home_wins %>% add_column(a_wins = away_wins$a_wins) %>% mutate(games_won = h_wins + a_wins)
#total games played
home_games <- baseball %>% group_by(h_name, year) %>% summarize(home_games = n())
away_games <- baseball %>% group_by(v_name, year) %>% summarize(away_games = n())
win_perc <- home_games %>% add_column(away_games = away_games$away_games) %>% mutate(games_played = home_games + away_games) %>% add_column(games_won = team_year_wins$games_won) %>% mutate(win_perc = games_won/games_played)

#pythagorean winning percentage
runs_h <- baseball %>% group_by(h_name, year) %>% summarize(runs_at_home = sum(h_score))
runs_a <- baseball %>% group_by(v_name, year) %>% summarize(runs_away = sum(v_score))
runs_total <- runs_h %>% add_column(runs_away = runs_a$runs_away) %>% mutate(runs_total = runs_away +runs_at_home)


h_allowed <- baseball %>% group_by(h_name, year) %>% summarize(home_allowed = sum(v_score))
a_allowed <- baseball %>% group_by(v_name, year) %>% summarize(away_allowed = sum(h_score))
allowed_total <- h_allowed %>% add_column(away_allowed = a_allowed$away_allowed) %>% mutate(allowed_total = home_allowed + away_allowed)

teams_pythag <- runs_total %>% add_column(allowed_total = allowed_total$allowed_total) %>% mutate(pythag_win = ((runs_total)^2)/(((runs_total)^2) + ((allowed_total)^2))) %>% add_column(win_perc = win_perc$win_perc)


#barplot for Boston Red Sox
teams_pythag %>% filter(h_name == "BOS") %>% 
  select(year, win_perc, pythag_win) %>% 
  pivot_longer(-(h_name:year), names_to = "pythag_actual", values_to = "percentage") %>%
  ggplot(aes(x=year, y=percentage, fill = pythag_actual)) + 
  geom_bar(stat = "identity", position = "dodge") + 
  scale_x_discrete(guide = guide_axis(n.dodge=2)) + 
          
<<<<<<< HEAD
           labs(title = "Pythagorean Winning Prediction versus Actual Winning Percentage", 
                x = "Years", 
                y = "Percentage", 
                color = "Percentage Calculation")
=======
  labs(title = "Pythagorean Winnng Prediction versus Actual Winning Percentage", 
    x = "Years", 
    y = "Percentage", 
    color = "Percentage Calculation")
>>>>>>> f8c4830276ffe44b904995998771e1ab57c22631

```
Because it can be hard to view how different these two values are, we can run a T-test and check the statistical significance of the prediction we've made. If we had hypothesized if this is an appropriate estimate for wins, we would accept or reject our hypothesis on the basis of the T-test: 

``` {r, graph2_cont}
# different representation:
bos <- teams_pythag %>% filter(h_name=="BOS")
(stat_sig <- t.test(bos$pythag_win, bos$win_perc, paired = TRUE))

```
Our p-value is greater than 0.05 (a value 0.05475) which indicated that our results are not statistically significant. To say that our prediction is not statistically significant from the actual winning percentage is to say the values are more or les similar and that this metric is a good predictor of wins. 

The next step after this data exploration would be to reproduce the result for more teams. 


Graph #3 - A logistical model predicting wins or losses

```{r}
baseballlog <- baseball %>% filter(h_name=="BOS")

baseballlog

mylogit <- glm(h_win_loss ~ h_errors + v_errors + h_left_on_base + v_left_on_base + h_homeruns + v_homeruns, data = baseballlog, family = "binomial")

summary(mylogit)

confint(mylogit)

meandata <- with(baseballlog, data.frame(h_errors = mean(h_errors), v_errors = mean(v_errors), h_left_on_base = mean(h_left_on_base), v_left_on_base = mean(v_left_on_base), h_homeruns = mean(h_homeruns), v_homeruns = mean(v_homeruns)))

meandata
```


In Blogposts 2/3, you should have identified some of the big obvious trends in the data. One question to ask now is whether those trends are the interesting or boring part of the data. In other words, do you want to get a more detailed explanation for the trend by exploring its relationship to other variables? Or do you want to explore some other relationship that might be confounded by the major trend you identified? Overall, both of these require you to start to explore further in your data. Think about exploring both for breadth (looking at relationships among many different variables or groupings) and depth (developing a better understanding of a specific relationship and how other variables fit in).
Additionally, now is a good time to start thinking about statistical modeling. What response variable are you interested in? What predictor variables? Are there transformations of columns that you’d need to do to create interesting predictors? What type of model do you want to fit? Linear? Logistic? Or something else? (Ask me!)
For this week’s blog post, discuss both going deeper and broader into your EDA and your initial thoughts and results for modeling. As always, make lots of plots and try different types of plots. However, for this week’s post, only include at most 2 figures/tables/output for your EDA and at most 1 figure/table/output for the modeling. Try to put together figures that illustrate the main lesson’s you’ve learned this week.
