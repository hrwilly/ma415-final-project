---
title: Blog Post 4, Week of 10/31/2022
author: Daniel Sussman
date: '2022-11-03'
slug: []
categories: []
tags: []
description: ~
toc: yes
authors: []
series: []
lastmod: '2022-11-03T19:02:24-04:00'
featuredVideo: ~
featuredImage: ~
---


<div id="TOC">

</div>

<p>Two graphs EDA, one modeling graph</p>
<p>Graph #1 - Truly Exploratory Data:</p>
<pre class="r"><code>#Loading and cleaning the data
library(tidyverse)</code></pre>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
## ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 
## ✔ tibble  3.1.8      ✔ dplyr   1.0.10
## ✔ tidyr   1.2.1      ✔ stringr 1.4.1 
## ✔ readr   2.1.2      ✔ forcats 0.5.2 
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>data &lt;- read_csv(here::here(&quot;dataset-ignore&quot;, &quot;game_logs.csv&quot;))</code></pre>
<pre><code>## Warning: One or more parsing issues, see `problems()` for details</code></pre>
<pre><code>## Rows: 171907 Columns: 161
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (75): day_of_week, v_name, v_league, h_name, h_league, day_night, protes...
## dbl (83): date, number_of_game, v_game_number, h_game_number, v_score, h_sco...
## lgl  (3): completion, forefeit, rf_umpire_id
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>baseball &lt;- as_tibble(data)
years&lt;-c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016)
(baseball &lt;- baseball %&gt;% separate(date,into=c(&quot;year&quot;,&quot;month_day&quot;),sep=4) %&gt;% 
                          separate(month_day,into=c(&quot;month&quot;,&quot;day&quot;),sep=2) %&gt;% 
                          filter(year %in% years) %&gt;% 
                          mutate(score_diff=h_score-v_score))</code></pre>
<pre><code>## # A tibble: 41,298 × 164
##    year  month day   number_of_g…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 2000  03    29                0 Wed     CHN    NL            1 NYN    NL     
##  2 2000  03    30                0 Thu     NYN    NL            2 CHN    NL     
##  3 2000  04    03                0 Mon     COL    NL            1 ATL    NL     
##  4 2000  04    03                0 Mon     MIL    NL            1 CIN    NL     
##  5 2000  04    03                0 Mon     SFN    NL            1 FLO    NL     
##  6 2000  04    03                0 Mon     LAN    NL            1 MON    NL     
##  7 2000  04    03                0 Mon     SDN    NL            1 NYN    NL     
##  8 2000  04    03                0 Mon     CHN    NL            3 SLN    NL     
##  9 2000  04    03                0 Mon     NYA    AL            1 ANA    AL     
## 10 2000  04    03                0 Mon     CLE    AL            1 BAL    AL     
## # … with 41,288 more rows, 154 more variables: h_game_number &lt;dbl&gt;,
## #   v_score &lt;dbl&gt;, h_score &lt;dbl&gt;, length_outs &lt;dbl&gt;, day_night &lt;chr&gt;,
## #   completion &lt;lgl&gt;, forefeit &lt;lgl&gt;, protest &lt;chr&gt;, park_id &lt;chr&gt;,
## #   attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;, v_line_score &lt;chr&gt;,
## #   h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;, v_doubles &lt;dbl&gt;,
## #   v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;, v_sacrifice_hits &lt;dbl&gt;,
## #   v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;, v_walks &lt;dbl&gt;, …</code></pre>
<pre class="r"><code>#Creating variables to compare a win to the starting pitcher, to see if having a certain pitcher matters towards a win
#This is focusing specifically on Boston Red Sox in their home stadium
pitcher_win&lt;-baseball %&gt;% filter(h_name==&quot;BOS&quot;,h_score&gt;v_score) %&gt;% group_by(h_starting_pitcher_name,year) %&gt;% count(h_starting_pitcher_name) %&gt;% rename(games_won=n)

pitcher_played&lt;-baseball %&gt;% filter(h_name==&quot;BOS&quot;) %&gt;% group_by(h_starting_pitcher_name,year) %&gt;% count(h_starting_pitcher_name) %&gt;% rename(games_played=n)

pitcher_prop&lt;-full_join(pitcher_played,pitcher_win) %&gt;% mutate(prop=games_won/games_played) %&gt;% replace_na(list(games_won=0,prop=0,games_played=0))</code></pre>
<pre><code>## Joining, by = c(&quot;h_starting_pitcher_name&quot;, &quot;year&quot;)</code></pre>
<pre class="r"><code>#Graphing the proportion of games won to games played for each starting pitcher per season from 2000-2016.
pitcher_win %&gt;% group_by(year) %&gt;% ggplot(aes(h_starting_pitcher_name,games_won,fill=h_starting_pitcher_name))+geom_col(show.legend=FALSE)+coord_flip()+facet_wrap(vars(year),scales=&quot;free&quot;)+theme(axis.text.y=element_blank())</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/graph1-1.png" width="672" /></p>
<p>Graph #2 - An experiment in the accuracy of the Pythagorean Winning Percentage (PWP)</p>
<p><span class="math display">\[Pythagroean\ Winning\ Percentage = runs\ scored\ ^{2} / (run\ scored\ ^{2} + runs\ allowed\  ^{2})\]</span>
Compare the PWP to the actual winning percentage of the team.
- create winning percentage column: mutate(if(h_score&gt;v_score) add column = win or TRUE )
do a similar mutation for losses, and sum the wins divided by total
- Pythagorean column: baseball %&gt;% mutate(pwp = h_score^2 / (h_score^2 + v_score^2))<br />
- group by team and filter for only one team
- plot one teams pwd vs year, and the actual winning percentage per year or season</p>
<p>missing a group my season or group by year (however baseball works) in here somewhere</p>
<pre class="r"><code>library(tidyverse)
data &lt;- read_csv(here::here(&quot;dataset-ignore&quot;, &quot;game_logs.csv&quot;))</code></pre>
<pre><code>## Warning: One or more parsing issues, see `problems()` for details</code></pre>
<pre><code>## Rows: 171907 Columns: 161
## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (75): day_of_week, v_name, v_league, h_name, h_league, day_night, protes...
## dbl (83): date, number_of_game, v_game_number, h_game_number, v_score, h_sco...
## lgl  (3): completion, forefeit, rf_umpire_id
## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<pre class="r"><code>baseball &lt;- as_tibble(data)
years&lt;-c(2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016)
#cleaned dataset to work with
(baseball &lt;- baseball %&gt;% separate(date,into=c(&quot;year&quot;,&quot;month_day&quot;),sep=4) %&gt;% 
  separate(month_day,into=c(&quot;month&quot;,&quot;day&quot;),sep=2) %&gt;% 
  filter(year %in% years) %&gt;% 
  mutate(score_diff=h_score-v_score))</code></pre>
<pre><code>## # A tibble: 41,298 × 164
##    year  month day   number_of_g…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 2000  03    29                0 Wed     CHN    NL            1 NYN    NL     
##  2 2000  03    30                0 Thu     NYN    NL            2 CHN    NL     
##  3 2000  04    03                0 Mon     COL    NL            1 ATL    NL     
##  4 2000  04    03                0 Mon     MIL    NL            1 CIN    NL     
##  5 2000  04    03                0 Mon     SFN    NL            1 FLO    NL     
##  6 2000  04    03                0 Mon     LAN    NL            1 MON    NL     
##  7 2000  04    03                0 Mon     SDN    NL            1 NYN    NL     
##  8 2000  04    03                0 Mon     CHN    NL            3 SLN    NL     
##  9 2000  04    03                0 Mon     NYA    AL            1 ANA    AL     
## 10 2000  04    03                0 Mon     CLE    AL            1 BAL    AL     
## # … with 41,288 more rows, 154 more variables: h_game_number &lt;dbl&gt;,
## #   v_score &lt;dbl&gt;, h_score &lt;dbl&gt;, length_outs &lt;dbl&gt;, day_night &lt;chr&gt;,
## #   completion &lt;lgl&gt;, forefeit &lt;lgl&gt;, protest &lt;chr&gt;, park_id &lt;chr&gt;,
## #   attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;, v_line_score &lt;chr&gt;,
## #   h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;, v_doubles &lt;dbl&gt;,
## #   v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;, v_sacrifice_hits &lt;dbl&gt;,
## #   v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;, v_walks &lt;dbl&gt;, …</code></pre>
<pre class="r"><code>#win/loss column (1 = win, 0 = loss or tie)
h_win_loss &lt;- function(h, v) {
  ifelse(h &gt; v, 1, 0)
}
(baseball &lt;- baseball %&gt;% mutate(h_win_loss = h_win_loss(h_score, v_score)))</code></pre>
<pre><code>## # A tibble: 41,298 × 165
##    year  month day   number_of_g…¹ day_o…² v_name v_lea…³ v_gam…⁴ h_name h_lea…⁵
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 2000  03    29                0 Wed     CHN    NL            1 NYN    NL     
##  2 2000  03    30                0 Thu     NYN    NL            2 CHN    NL     
##  3 2000  04    03                0 Mon     COL    NL            1 ATL    NL     
##  4 2000  04    03                0 Mon     MIL    NL            1 CIN    NL     
##  5 2000  04    03                0 Mon     SFN    NL            1 FLO    NL     
##  6 2000  04    03                0 Mon     LAN    NL            1 MON    NL     
##  7 2000  04    03                0 Mon     SDN    NL            1 NYN    NL     
##  8 2000  04    03                0 Mon     CHN    NL            3 SLN    NL     
##  9 2000  04    03                0 Mon     NYA    AL            1 ANA    AL     
## 10 2000  04    03                0 Mon     CLE    AL            1 BAL    AL     
## # … with 41,288 more rows, 155 more variables: h_game_number &lt;dbl&gt;,
## #   v_score &lt;dbl&gt;, h_score &lt;dbl&gt;, length_outs &lt;dbl&gt;, day_night &lt;chr&gt;,
## #   completion &lt;lgl&gt;, forefeit &lt;lgl&gt;, protest &lt;chr&gt;, park_id &lt;chr&gt;,
## #   attendance &lt;dbl&gt;, length_minutes &lt;dbl&gt;, v_line_score &lt;chr&gt;,
## #   h_line_score &lt;chr&gt;, v_at_bats &lt;dbl&gt;, v_hits &lt;dbl&gt;, v_doubles &lt;dbl&gt;,
## #   v_triples &lt;dbl&gt;, v_homeruns &lt;dbl&gt;, v_rbi &lt;dbl&gt;, v_sacrifice_hits &lt;dbl&gt;,
## #   v_sacrifice_flies &lt;dbl&gt;, v_hit_by_pitch &lt;dbl&gt;, v_walks &lt;dbl&gt;, …</code></pre>
<pre class="r"><code>#red sox games
bos &lt;- baseball %&gt;% filter(h_name == &quot;BOS&quot;|v_name == &quot;BOS&quot;)

#for all teams
#total games won
home_wins &lt;- baseball %&gt;% group_by(h_name, year) %&gt;% summarize(h_wins = sum(h_win_loss == 1))</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;h_name&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>away_wins &lt;- baseball %&gt;% group_by(v_name, year) %&gt;% summarize(a_wins = sum(h_win_loss == 0)) %&gt;% rename(h_name = v_name)</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;v_name&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>team_year_wins &lt;- home_wins %&gt;% add_column(a_wins = away_wins$a_wins) %&gt;% mutate(games_won = h_wins + a_wins)
#total games played
home_games &lt;- baseball %&gt;% group_by(h_name, year) %&gt;% summarize(home_games = n())</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;h_name&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>away_games &lt;- baseball %&gt;% group_by(v_name, year) %&gt;% summarize(away_games = n()) %&gt;% rename(h_name = v_name)</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;v_name&#39;. You can override using the
## `.groups` argument.</code></pre>
<pre class="r"><code>games_played &lt;- home_games %&gt;% add_column(away_games = away_games$away_games) %&gt;% mutate(game_played = home_games + away_games)

#for Boston Red Sox, grouped by season/year, actual winning percentage
h_wins &lt;- bos %&gt;% filter(h_name == &quot;BOS&quot;) %&gt;% group_by(year) %&gt;% summarize(home_games_won = sum(h_win_loss == 1))
a_wins &lt;- bos %&gt;% filter(v_name == &quot;BOS&quot;) %&gt;% group_by(year) %&gt;% summarize(away_games_won = sum(h_win_loss == 0))
wins &lt;- h_wins %&gt;% left_join(a_wins, by = &quot;year&quot;) %&gt;% mutate(games_won = home_games_won + away_games_won)

(win_percentage &lt;- baseball %&gt;% filter(h_name == &quot;BOS&quot; | v_name == &quot;BOS&quot;) %&gt;% 
  group_by(year) %&gt;% 
  summarize(total_games_played = n()) %&gt;% 
  left_join(wins, by = &quot;year&quot;) %&gt;% 
  mutate(win_percentage = games_won/total_games_played))</code></pre>
<pre><code>## # A tibble: 17 × 6
##    year  total_games_played home_games_won away_games_won games_won win_percen…¹
##    &lt;chr&gt;              &lt;int&gt;          &lt;int&gt;          &lt;int&gt;     &lt;int&gt;        &lt;dbl&gt;
##  1 2000                 162             42             43        85        0.525
##  2 2001                 161             41             41        82        0.509
##  3 2002                 162             42             51        93        0.574
##  4 2003                 162             53             42        95        0.586
##  5 2004                 162             55             43        98        0.605
##  6 2005                 162             54             41        95        0.586
##  7 2006                 162             48             38        86        0.531
##  8 2007                 162             51             45        96        0.593
##  9 2008                 162             56             39        95        0.586
## 10 2009                 162             56             39        95        0.586
## 11 2010                 162             46             43        89        0.549
## 12 2011                 162             45             45        90        0.556
## 13 2012                 162             34             35        69        0.426
## 14 2013                 162             53             44        97        0.599
## 15 2014                 162             34             37        71        0.438
## 16 2015                 162             43             35        78        0.481
## 17 2016                 162             47             46        93        0.574
## # … with abbreviated variable name ¹​win_percentage</code></pre>
<pre class="r"><code>#for Boston Red Sox, grouped by season/year, Pythagorean winning percentage
runs_home &lt;- bos %&gt;% filter(h_name == &quot;BOS&quot;) %&gt;% group_by(year) %&gt;% summarize(runs_at_home = sum(h_score))
runs_away &lt;- bos %&gt;% filter(v_name == &quot;BOS&quot;) %&gt;% group_by(year) %&gt;% summarize(runs_away = sum(v_score))
total_runs &lt;- runs_home %&gt;% left_join(runs_away, by = &quot;year&quot;) %&gt;% mutate(total_runs = runs_at_home + runs_away)

home_allowed &lt;- bos %&gt;% filter(h_name == &quot;BOS&quot;) %&gt;% group_by(year) %&gt;% summarize(home_allowed = sum(v_score))
away_allowed &lt;- bos %&gt;% filter(v_name == &quot;BOS&quot;) %&gt;% group_by(year) %&gt;% summarize(away_allowed = sum(h_score))
total_allowed &lt;- home_allowed %&gt;% left_join(away_allowed, by = &quot;year&quot;) %&gt;% mutate(total_allowed = home_allowed + away_allowed)

pythag &lt;- total_runs %&gt;% left_join(total_allowed, by = &quot;year&quot;) %&gt;% mutate(pythag_win = ((total_runs)^2)/(((total_runs)^2) + ((total_allowed)^2))) %&gt;% left_join(win_percentage, by = &quot;year&quot;)

#barplot
pythag %&gt;% select(year, win_percentage, pythag_win) %&gt;% pivot_longer(-year, names_to = &quot;win_pythag&quot;, values_to = &quot;percentage&quot;) %&gt;% ggplot(aes(x=year, y=percentage, fill = win_pythag)) + geom_bar(stat = &quot;identity&quot;, position = &quot;dodge&quot;) + scale_x_discrete(guide = guide_axis(n.dodge=2))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>Graph #3 - A logistical model predicting wins or losses</p>
<p>In Blogposts 2/3, you should have identified some of the big obvious trends in the data. One question to ask now is whether those trends are the interesting or boring part of the data. In other words, do you want to get a more detailed explanation for the trend by exploring its relationship to other variables? Or do you want to explore some other relationship that might be confounded by the major trend you identified? Overall, both of these require you to start to explore further in your data. Think about exploring both for breadth (looking at relationships among many different variables or groupings) and depth (developing a better understanding of a specific relationship and how other variables fit in).
Additionally, now is a good time to start thinking about statistical modeling. What response variable are you interested in? What predictor variables? Are there transformations of columns that you’d need to do to create interesting predictors? What type of model do you want to fit? Linear? Logistic? Or something else? (Ask me!)
For this week’s blog post, discuss both going deeper and broader into your EDA and your initial thoughts and results for modeling. As always, make lots of plots and try different types of plots. However, for this week’s post, only include at most 2 figures/tables/output for your EDA and at most 1 figure/table/output for the modeling. Try to put together figures that illustrate the main lesson’s you’ve learned this week.</p>
