---
title: Analysis
description:
toc: true
featuredVideo:
featuredImage: images/analysis_page.jpg
draft: false
---

We describe here our detailed data analysis.


## Rubric: On this page

you will


* Modeling and Inference 
  * You should also include some kind of formal statistical model and/or inference. This could be a linear regression, logistic regression, hypothesis testing etc.
  * Explain the techniques you used for validating your results.
  * Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.
* Explain the flaws and limitations of your analysis
  * Are there some assumptions that you needed to make that might not hold? Is there other data that would help to answer your questions? ...
* Clarity Figures
  * Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?
  * Each figure should provide a key insight. Too many figures or other data summaries can detract from this.
* Clarity of Explanations
  * Do you introduce why you are doing each analysis?
  * How well do you explain each figure/result?
  * Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?
* Organization and cleanliness.
  * Make sure to remove excessive warnings, use clean easy-to-read code, organize with sections or multiple pages, use bullets, etc.
  

## Data Analysis Motivations

For our data analysis, we are most interested in the relationship between the `win_perc` variable in our `win_perc` data set we created, which can be found in our Data page, and the `payroll` variable from our `mlb_payroll` dataset. We are also interested in the effects of a team's payroll on their offensive performance of a given season explained by variables such as `hits` and `homeruns`. We wish to look at the whether a particular team's winning percentage changes each season with that team's payroll. Does a high payroll correspond with more wins and therefore higher success? If not, what factors lead to a team losing even with such high payrolls?


```{r maysen_modeling}
suppressPackageStartupMessages(library(tidyverse))
load(here::here("dataset", "win_perc.RData"))
load(here::here("dataset", "mlb_payroll.RData"))
load(here::here("dataset", "baseball.RData"))

payroll_win <- win_perc %>% left_join(mlb_payroll, by = c("year", "h_name")) %>% filter(!is.na(payroll))
(payroll_mod <- lm(win_perc ~ log(payroll), data = payroll_win))
beta <- coef(payroll_mod)

# for all teams, as payroll increases, winning percentage for a given year increases
ggplot(payroll_win) + geom_point(aes(log(payroll), win_perc)) + 
  geom_abline(intercept = beta[1], slope = beta[2], color = "red")

#Pittsburgh pirates are a team who match this overall pattern
pit <- payroll_win %>% filter(h_name == "PIT")
pit_mod <- lm(win_perc~log(payroll), data = pit)
pit_beta <- coef(pit_mod)
ggplot(pit) + geom_point(aes(log(payroll), win_perc)) + 
  geom_abline(intercept = pit_beta[1], slope = pit_beta[2], color = "red")

#find year payroll was lowest and highest for Pittsburgh
mlb_payroll %>% filter(h_name == "PIT") %>% arrange(payroll)
#2000 lowest 2015 highest

bb <- baseball %>% mutate(win_loss = ifelse(score_diff>1, 1, 0))

#home games - each starting pitcher's prop of games winning of games started
#2000
bb %>% filter(h_name == "PIT", year == 2000) %>% 
  group_by(h_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(h_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = h_starting_pitcher_name))
#2015
bb %>% filter(h_name == "PIT", year == 2015) %>% 
  group_by(h_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(h_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = h_starting_pitcher_name))

#away games - each starting pitcher's prop of games winning of games started
#2000
bb %>% filter(v_name == "PIT", year == 2000) %>% 
  group_by(v_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(v_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = v_starting_pitcher_name))

#2015
bb %>% filter(v_name == "PIT", year == 2015) %>% 
  group_by(v_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(v_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = v_starting_pitcher_name))


# for chicago white sox, as payroll increases, winning percentage decreases
cha <- payroll_win %>% filter(h_name == "CHA")
cha_mod <- lm(win_perc~log(payroll), data = cha)
cha_beta <- coef(cha_mod)
ggplot(cha) + geom_point(aes(log(payroll), win_perc)) + 
  geom_abline(intercept = cha_beta[1], slope = cha_beta[2], color = "red")

#find year payroll was lowest and highest for chicago
mlb_payroll %>% filter(h_name == "CHA") %>% arrange(payroll)
#2000 lowest 2011 highest

#home games - each starting pitcher's prop of games winning of games started
#2000
bb %>% filter(h_name == "CHA", year == 2000) %>% 
  group_by(h_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(h_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = h_starting_pitcher_name))

#2011
bb %>% filter(h_name == "CHA", year == 2011) %>% 
  group_by(h_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(h_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = h_starting_pitcher_name))

#away games - each starting pitcher's prop of games winning of games started
#2000
bb %>% filter(v_name == "CHA", year == 2000) %>% 
  group_by(v_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(v_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = v_starting_pitcher_name))

#2011
bb %>% filter(v_name == "CHA", year == 2011) %>% 
  group_by(v_starting_pitcher_name) %>%
  summarize(games_started = n(), 
            games_won = sum(v_starting_pitcher_name==winning_pitcher_name), 
            prop = games_won/games_started) %>% 
  arrange(desc(games_started)) %>%
  ggplot(aes(games_started, prop)) + 
  geom_point(aes(color = v_starting_pitcher_name))

#########################

bb %>% filter(h_name == "CHA", year == 2000) %>% group_by(h_player_3_name) %>% summarize(count = n())
#home games, 2000, how many games Thomas Frank won when he started first base
bb %>% filter(h_name == "CHA", year == 2000) %>% summarize(FT_start = sum(h_player_3_name=="Frank Thomas"), wins = sum(h_player_3_name=="Frank Thomas" & win_loss==1), prop = wins/FT_start)

#away games, 2000, how many games Thomas Frank won when he started first base
bb %>% filter(v_name == "CHA", year == 2000) %>% summarize(FT_start = sum(v_player_3_name=="Frank Thomas"), wins = sum(v_player_3_name=="Frank Thomas" & score_diff<0), prop = wins/FT_start)

bb %>% filter(h_name == "CHA", year == 2011) %>% group_by(h_player_3_name) %>% summarize(count = n())
#home games, 2000, how many games paul konerko, carlos Q, Adam D won when he started first base
bb %>% filter(h_name == "CHA", year == 2011) %>% summarize(FT_start = sum(h_player_3_name=="Paul Konerko"), wins = sum(h_player_3_name=="Paul Konerko" & win_loss==1), prop = wins/FT_start)
bb %>% filter(h_name == "CHA", year == 2011) %>% summarize(FT_start = sum(h_player_3_name=="Carlos Quentin"), wins = sum(h_player_3_name=="Carlos Quentin" & win_loss==1), prop = wins/FT_start)
bb %>% filter(h_name == "CHA", year == 2011) %>% summarize(FT_start = sum(h_player_3_name=="Adam Dunn"), wins = sum(h_player_3_name=="Adam Dunn" & win_loss==1), prop = wins/FT_start)

#away games, 2000, how many games paul konerko, carlos Q, Adam D won when he started first base
bb %>% filter(v_name == "CHA", year == 2011) %>% summarize(FT_start = sum(v_player_3_name=="Paul Konerko"), wins = sum(v_player_3_name=="Paul Konerko" & score_diff<0), prop = wins/FT_start)
bb %>% filter(v_name == "CHA", year == 2011) %>% summarize(FT_start = sum(v_player_3_name=="Carlos Quentin"), wins = sum(v_player_3_name=="Carlos Quentin" & score_diff<0), prop = wins/FT_start)
bb %>% filter(v_name == "CHA", year == 2011) %>% summarize(FT_start = sum(v_player_3_name=="Adam Dunn"), wins = sum(v_player_3_name=="Adam Dunn" & score_diff<0), prop = wins/FT_start)
#concl --> chicago won more games when frank thomas started in 2000 than combo of three players in 2011